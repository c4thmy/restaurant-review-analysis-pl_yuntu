# 合规版使用说明和指南

## 🔐 法律合规版本说明

本版本是原项目的合规加强版，专门为学术研究和教育学习设计，包含完整的法律保护和隐私保护机制。

### 📋 主要变更

#### 1. 合规性增强
- ✅ **严格的频率限制**：每分钟最多10次请求，每天最多500次
- ✅ **数据量限制**：单次最多获取500条评论，时间范围限制为1个月
- ✅ **自动匿名化**：用户信息自动哈希化处理
- ✅ **robots.txt遵守**：自动检查并遵守网站访问规则
- ✅ **使用目的限制**：仅允许research、learning、academic用途

#### 2. 隐私保护
- 🔒 **用户身份保护**：所有用户名转换为哈希值
- 🔒 **敏感信息过滤**：自动检测和移除电话、邮箱等敏感信息
- 🔒 **时间泛化**：具体时间转换为时间段
- 🔒 **内容清理**：移除可能的个人标识信息

#### 3. 审计和监控
- 📊 **详细日志**：记录所有操作和访问
- 📊 **合规报告**：自动生成合规检查报告
- 📊 **使用统计**：跟踪使用频率和目的
- 📊 **数据保留**：30天自动提醒清理

## 🚀 快速开始（合规版）

### 1. 环境准备
```bash
# 确保包含所有合规文件
ls USER_AGREEMENT.md RESEARCH_PURPOSE.md

# 安装依赖
pip install -r requirements.txt
```

### 2. 首次使用流程

#### Step 1: 阅读法律文件
```bash
# 必须阅读的文件
cat USER_AGREEMENT.md      # 用户协议
cat RESEARCH_PURPOSE.md    # 研究目的声明
```

#### Step 2: 确认研究目的
运行前需要明确您的使用目的：
- `research` - 学术研究
- `learning` - 技术学习
- `academic` - 课程作业

#### Step 3: 运行合规版程序
```bash
# 使用合规版主程序
python ccc-main.py pipeline "示例餐厅" --city 北京 --months 1
```

### 3. 交互式确认流程

运行时系统会要求您确认：

```
╔════════════════════════════════════════════════════════════════╗
║                         法律声明                                 ║
║  本软件仅供学习、研究和学术用途使用                                 ║
║  使用前请确认：                                                  ║
║  ✓ 已阅读并同意用户协议                                          ║
║  ✓ 已明确研究目的                                               ║
║  ✓ 将遵守所有相关法律法规                                         ║
╚════════════════════════════════════════════════════════════════╝

使用条款确认
1. 您确认已阅读并理解用户协议吗？
2. 您确认使用目的仅限于学习和研究吗？
3. 您承诺遵守所有法律法规和网站使用条款吗？
4. 您理解数据将被匿名化处理且有保留期限吗？

请输入 'yes' 表示同意，'no' 表示拒绝: yes

请选择您的使用目的：
1. research - 学术研究
2. learning - 技术学习
3. academic - 课程作业

请输入选项编号 (1-3): 1
```

## 📊 合规功能详解

### 1. 自动数据保护

#### 用户信息匿名化
```python
# 原始数据
{
  "username": "用户张三",
  "content": "味道不错，推荐！"
}

# 处理后数据
{
  "user_id": "a1b2c3d4",  # 哈希化
  "content": "味道不错，推荐！",
  "privacy_protected": true
}
```

#### 敏感信息过滤
```python
# 自动检测和清理
"我的电话是13812345678" → "我的电话是[手机号]"
"邮箱: user@example.com" → "邮箱: [邮箱]"
```

#### 时间泛化处理
```python
# 精确时间 → 时间段
"2024-01-15 14:30:00" → "一个月内"
"3天前" → "一周内"
```

### 2. 访问频率控制

#### 自动限流机制
```python
# 内置限制
{
  "MIN_DELAY": 5,              # 最小间隔5秒
  "MAX_REQUESTS_PER_MINUTE": 10,  # 每分钟最多10次
  "MAX_REQUESTS_PER_HOUR": 200,   # 每小时最多200次
  "MAX_REQUESTS_PER_DAY": 1000,   # 每天最多1000次
}
```

#### robots.txt遵守
```python
# 自动检查网站规则
compliance_checker.check_robots_txt(url)
# 自动调整延迟时间
# 记录访问日志
```

### 3. 数据生命周期管理

#### 自动保留期限检查
```bash
# 运行时自动检查
python ccc-main.py pipeline "餐厅名"

检查数据保留期限...
⚠ 发现 3 个超过保留期限的文件
建议删除以下文件：
  - data/comments_old_20241001_120000.json
  - data/analysis_old_20241001_120000.json

是否自动删除过期文件？(y/N): y
```

#### 数据包格式
```json
{
  "metadata": {
    "collection_time": "2024-10-15T10:30:00",
    "user_id": "researcher_001",
    "purpose": "research",
    "total_comments": 245,
    "compliance_version": "1.0",
    "data_retention_until": "2024-11-15T10:30:00",
    "privacy_protected": true,
    "anonymized": true
  },
  "comments": [...]
}
```

## 🛠️ 合规版命令参考

### 基础命令

#### 1. 完整流程（推荐）
```bash
# 学术研究用途
python ccc-main.py pipeline "餐厅名称" --city 北京 --months 1

# 参数说明
# --months: 限制为1，确保数据量合理
# 系统会自动引导用户确认协议
```

#### 2. 分步执行
```bash
# 第1步：爬取评论
python ccc-main.py crawl "餐厅名称" --city 北京 --months 1

# 第2步：分析评论
python ccc-main.py analyze data/comments_餐厅名称_20241015_143022.json

# 第3步：生成词云
python ccc-main.py wordcloud data/comments_餐厅名称_20241015_143022_analysis.json
```

#### 3. 合规检查
```bash
# 生成合规报告
python ccc-main.py compliance

# 输出示例
合规报告已生成
合规状态: COMPLIANT
建议:
  - 建议增加请求延迟至5秒以上
  - 发现2个超过保留期限的数据文件，建议及时清理
```

### Web界面（合规版）

#### 启动服务
```bash
python ccc-main.py web
```

#### 合规功能
- 🔐 **协议确认页面**：用户必须先同意协议
- 🔐 **目的声明**：必须选择使用目的
- 🔐 **实时限制提示**：显示当前使用情况
- 🔐 **数据保护状态**：显示隐私保护措施

## 📁 合规版文件结构

```
@cc-code/
├── ccc-main.py                           # 合规版主程序
├── ccc-config.py                         # 合规配置文件
├── USER_AGREEMENT.md                     # 用户协议
├── RESEARCH_PURPOSE.md                   # 研究目的声明
├── dianping_spider/
│   ├── spiders/
│   │   └── ccc-compliance_spider.py      # 合规爬虫
│   ├── utils/
│   │   └── ccc-compliance_checker.py     # 合规检查器
│   └── web/
│       └── ccc-compliance_app.py         # 合规Web应用
└── logs/                                 # 审计日志目录
    ├── compliance.log                    # 合规日志
    ├── spider_compliance.log             # 爬虫合规日志
    ├── data_operations.log               # 数据操作日志
    ├── agreements/                       # 用户协议记录
    ├── sessions/                         # 会话记录
    └── compliance_reports/               # 合规报告
```

## 🔍 合规检查和审计

### 1. 实时合规监控

#### 访问频率监控
```python
# 自动记录每次访问
{
  "timestamp": "2024-10-15T10:30:00",
  "url": "https://www.dianping.com/...",
  "user_id": "researcher_001",
  "purpose": "research",
  "elapsed_time": 5.2
}
```

#### 数据操作审计
```python
# 记录所有数据操作
{
  "timestamp": "2024-10-15T10:30:00",
  "user_id": "researcher_001",
  "operation": "save",
  "filename": "comments_餐厅_20241015.json",
  "record_count": 245,
  "purpose": "research"
}
```

### 2. 合规报告生成

#### 自动报告内容
```json
{
  "timestamp": "2024-10-15T10:30:00",
  "checks_performed": {
    "robots_txt_checked": 5,
    "rate_limit_domains": 2,
    "user_agreements": 1
  },
  "compliance_status": "COMPLIANT",
  "violations": [],
  "recommendations": [
    "建议增加请求延迟至5秒以上",
    "发现2个超过保留期限的数据文件，建议及时清理"
  ]
}
```

### 3. 违规预警机制

#### 自动检查项目
- ❌ 访问频率超限
- ❌ 数据量超限
- ❌ 未授权用途
- ❌ robots.txt违规
- ❌ 敏感信息泄露
- ❌ 数据保留超期

## 📚 研究使用最佳实践

### 1. 学术研究规范

#### 数据引用格式
```
数据来源: 大众点评公开评论数据
采集时间: 2024年10月15日
数据范围: 近1个月公开评论
处理方式: 匿名化和去标识化处理
使用目的: 学术研究，符合相关伦理要求
```

#### 伦理声明模板
```
本研究使用的数据来源于公开平台，已进行充分的隐私保护处理，
包括用户身份匿名化、敏感信息移除等措施。数据使用严格限于
学术研究目的，不涉及商业用途或个人隐私侵犯。
```

### 2. 技术学习建议

#### 合规编程实践
```python
# 1. 始终使用合规检查装饰器
@require_compliance_check
def my_crawl_function():
    pass

# 2. 数据处理前进行隐私检查
is_safe, msg = data_protector.check_data_sensitivity(text)
if not is_safe:
    # 跳过或清理数据

# 3. 记录所有重要操作
logger.info(f"用户{user_id}进行了{operation}操作")
```

#### 学习重点领域
- 🎯 **合规性设计**：如何在代码中集成法律要求
- 🎯 **隐私保护**：数据匿名化和去标识化技术
- 🎯 **访问控制**：频率限制和权限管理
- 🎯 **审计日志**：操作记录和合规追踪

### 3. 课程作业指导

#### 作业目标建议
- 📖 **理解合规要求**：学习法律法规对技术的约束
- 📖 **实践隐私保护**：实现数据脱敏和匿名化
- 📖 **系统设计**：设计考虑合规性的系统架构
- 📖 **文档编写**：撰写合规性说明和技术文档

#### 评估标准
- ✅ 代码是否包含合规检查
- ✅ 是否正确处理隐私数据
- ✅ 是否遵守访问频率限制
- ✅ 是否生成完整的审计日志

## ⚠️ 重要注意事项

### 法律风险提醒
1. **严格按目的使用**：不得超出声明的研究目的
2. **及时删除数据**：30天后必须删除相关数据
3. **保护用户隐私**：不得尝试反向识别用户身份
4. **遵守网站规则**：严格遵守目标网站的使用条款

### 技术使用建议
1. **测试先行**：先用小数据量测试功能
2. **监控资源**：注意网络和系统资源使用
3. **备份重要**：重要研究数据要做好备份
4. **版本控制**：使用git等工具管理代码版本

### 学术诚信要求
1. **引用数据源**：在研究成果中正确引用数据来源
2. **说明方法**：详细说明数据处理和分析方法
3. **披露限制**：说明数据的限制和可能的偏差
4. **伦理审查**：重要研究应通过伦理委员会审查

---

## 🆘 故障排除（合规版）

### 常见合规问题

#### 1. 协议确认失败
```
错误: 用户未同意使用协议
解决: 仔细阅读USER_AGREEMENT.md，确认理解后输入'yes'
```

#### 2. 访问频率超限
```
错误: 访问频率超限，请稍后再试
解决: 等待一段时间后重试，或调整ccc-config.py中的延迟设置
```

#### 3. 数据量超限
```
错误: 单次获取评论数量不能超过500条
解决: 减少时间范围或分批处理数据
```

#### 4. robots.txt禁止
```
错误: robots.txt禁止访问此URL
解决: 检查网站robots.txt文件，选择允许访问的页面
```

### 技术问题解决

#### 1. 合规模块导入失败
```bash
# 检查文件存在
ls ccc-config.py utils/ccc-compliance_checker.py

# 检查Python路径
python -c "import sys; print(sys.path)"
```

#### 2. 日志文件权限错误
```bash
# 创建日志目录并设置权限
mkdir -p logs/{agreements,sessions,compliance_reports}
chmod 755 logs
```

#### 3. 数据清理失败
```bash
# 手动清理过期数据
find data -name "*.json" -mtime +30 -delete
find logs -name "*.log" -mtime +30 -delete
```

---

## 📞 技术支持

### 获取帮助
- 📚 **文档**: 阅读完整的项目文档
- 🐛 **Bug报告**: 通过GitHub Issues报告问题
- 💬 **讨论**: 参与GitHub Discussions技术讨论
- 📧 **联系**: 通过邮件联系项目维护者

### 贡献指南
欢迎为合规功能改进做出贡献：
- 🔧 **代码改进**: 提交Pull Request
- 📝 **文档完善**: 改进使用说明
- 🧪 **测试用例**: 添加合规性测试
- 🌍 **国际化**: 支持多语言合规要求

---

*本合规版本旨在为学术界和教育界提供一个负责任的数据分析工具，感谢您的理解与支持！*